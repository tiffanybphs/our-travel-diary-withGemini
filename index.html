<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Our Travel Diary ğŸŒ¸</title>
    
    <link rel="icon" type="image/png" href="icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Zen Maru Gothic"', 'sans-serif'] },
                    colors: {
                        sakura: { light: '#FFF0F5', main: '#FFD1DC', dark: '#FFB7C5' },
                        cream: '#FFF9E3', cocoa: '#8B4513'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <style>
        body { background-color: #FFF9E3; color: #5D4037; }
        .splash-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: white url('splash.jpeg') no-repeat center center;
            background-size: cover;
            transition: opacity 0.8s ease;
        }
        .fade-out { opacity: 0; pointer-events: none; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-blur: 10px; }
    </style>
</head>
<body>

<div id="app">
    <div :class="['splash-screen', { 'fade-out': !showSplash }]"></div>

    <div class="max-w-md mx-auto bg-white min-h-screen relative shadow-2xl pb-20 overflow-hidden">
        
        <header class="relative h-64">
            <img src="header-bg(1).jpg" class="w-full h-full object-cover" onerror="this.src='https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=800'">
            <div class="absolute inset-0 bg-black/10"></div>
            
            <button @click="showSettings = true" class="absolute top-12 right-6 w-10 h-10 flex items-center justify-center bg-white/20 backdrop-blur-md rounded-full text-white">
                <i class="fa-solid fa-gear text-lg"></i>
            </button>

            <div class="absolute bottom-14 left-6 text-white">
                <h1 class="text-2xl font-bold tracking-widest">{{ trip.title || 'æˆ‘çš„æ—…éŠæ‰‹å¸³' }}</h1>
                <p class="text-sm opacity-90" v-if="trip.start_date">{{ trip.start_date }} âœ {{ trip.end_date }}</p>
            </div>
        </header>

        <div class="relative -mt-10 bg-white rounded-t-[40px] px-6 pt-8">
            <div v-if="!isConnected" class="py-20 text-center">
                <div class="mb-6 opacity-30">
                    <i class="fa-solid fa-cloud-slash text-6xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-400 mb-2">å°šæœªé€£æ¥è³‡æ–™åº«</h3>
                <p class="text-sm text-gray-300 mb-6">è«‹é»æ“Šå³ä¸Šè§’ âš™ï¸ é€²è¡Œè¨­å®š</p>
                <button @click="showSettings = true" class="px-8 py-2 border-2 border-sakura-main text-sakura-main rounded-full font-bold">
                    å‰å¾€è¨­å®š
                </button>
            </div>

            <div v-else class="space-y-4">
                <div v-for="item in schedules" :key="item.id" class="p-4 border border-gray-100 rounded-2xl shadow-sm flex gap-4">
                    <div class="font-bold text-sakura-dark">{{ item.start_time }}</div>
                    <div>
                        <h4 class="font-bold">{{ item.title }}</h4>
                        <p class="text-xs text-gray-400">{{ item.location }}</p>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="showSettings" class="fixed inset-0 z-[100] bg-black/40 backdrop-blur-sm flex items-end sm:items-center justify-center">
            <div class="bg-white w-full max-w-sm rounded-t-[30px] sm:rounded-[30px] p-8 shadow-2xl animate-slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-sakura-dark">é€£ç·šè¨­å®š âš™ï¸</h2>
                    <button @click="showSettings = false" class="text-gray-300"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-[10px] text-gray-400 ml-2 uppercase">Supabase URL</label>
                        <input v-model="config.url" placeholder="https://..." class="w-full p-3 mt-1 rounded-xl bg-gray-50 border border-gray-100 focus:border-sakura-main outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 ml-2 uppercase">Anon Key</label>
                        <input v-model="config.key" type="password" placeholder="ey..." class="w-full p-3 mt-1 rounded-xl bg-gray-50 border border-gray-100 focus:border-sakura-main outline-none">
                    </div>
                    
                    <button @click="connectSupabase" :disabled="loading" class="w-full bg-sakura-main text-white py-4 rounded-2xl font-bold shadow-lg shadow-sakura-main/20 active:scale-95 transition-transform">
                        <span v-if="!loading">å„²å­˜ä¸¦é€£ç·š</span>
                        <span v-else class="flex items-center justify-center gap-2">
                            <i class="fa-solid fa-circle-notch animate-spin"></i> é€£ç·šä¸­...
                        </span>
                    </button>
                    
                    <p v-if="errorMsg" class="text-red-400 text-xs text-center font-medium">{{ errorMsg }}</p>
                    <p v-if="isConnected" class="text-green-500 text-xs text-center">âœ… å·²æˆåŠŸé€£æ¥</p>
                </div>
            </div>
        </div>

        <div class="text-center text-[10px] text-gray-200 mt-10 pb-10">ğŸŒ¸ Tiffany & Benjamin ğŸŒ¸</div>
    </div>
</div>

<script>
const { createApp, ref, onMounted } = Vue;

createApp({
    setup() {
        const showSplash = ref(true);
        const showSettings = ref(false);
        const isConnected = ref(false);
        const loading = ref(false);
        const errorMsg = ref('');
        
        const config = ref({ 
            url: localStorage.getItem('sb_url') || '', 
            key: localStorage.getItem('sb_key') || '' 
        });
        
        const trip = ref({});
        const schedules = ref([]);
        let supabase = null;

        const connectSupabase = async () => {
            // ä¿®æ­£ï¼šå¢åŠ  .trim() ç¢ºä¿ä¸æœƒå› ç‚ºå‰å¾Œç©ºæ ¼å°è‡´åˆ¤æ–·éŒ¯èª¤
            const url = config.value.url.trim();
            const key = config.value.key.trim();

            if (!url || !key) {
                errorMsg.value = 'è«‹å¡«å¯«å®Œæ•´è³‡è¨Š';
                return;
            }

            loading.value = true;
            errorMsg.value = '';

            try {
                supabase = window.supabase.createClient(url, key);
                
                // å˜—è©¦è®€å–è³‡æ–™
                const { data: tripData, error: tripError } = await supabase.from('trips').select('*').limit(1).single();
                if (tripError) throw tripError;

                const { data: schData } = await supabase.from('schedules').select('*').order('sort_order');
                
                // æˆåŠŸå¾Œå„²å­˜
                trip.value = tripData;
                schedules.value = schData || [];
                localStorage.setItem('sb_url', url);
                localStorage.setItem('sb_key', key);
                
                isConnected.value = true;
                setTimeout(() => { showSettings.value = false; }, 800);
            } catch (err) {
                errorMsg.value = 'é€£ç·šå¤±æ•—ï¼šè«‹æª¢æŸ¥ URL æˆ– Key æ˜¯å¦æ­£ç¢º';
                console.error(err);
            } finally {
                loading.value = false;
            }
        };

        onMounted(() => {
            // è‡ªå‹•é€£ç·š
            if (config.value.url && config.value.key) {
                connectSupabase();
            }
            // 2.5 ç§’å¾Œé—œé–‰å•Ÿå‹•ç•«é¢
            setTimeout(() => { showSplash.value = false; }, 2500);
        });

        return { showSplash, showSettings, isConnected, loading, config, errorMsg, connectSupabase, trip, schedules };
    }
}).mount('#app');
</script>

<style>
@keyframes slide-up {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}
.animate-slide-up { animation: slide-up 0.4s ease-out; }
</style>
</body>
</html>
